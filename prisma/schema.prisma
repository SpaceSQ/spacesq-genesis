// SpaceSQ Genesis Schema
// Database: Supabase (PostgreSQL)

generator client {
  provider = "prisma-client-js"
}

// prisma/schema.prisma

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  // ğŸ‘ˆ è¿™é‡Œåªå†™å˜é‡åï¼Œä¸åŠ¨å®ƒ
  directUrl = env("DIRECT_URL")    // ğŸ‘ˆ è¿™é‡Œåªå†™å˜é‡åï¼Œä¸åŠ¨å®ƒ
}

// --- 1. ç³»ç»Ÿç®¡ç† (System Admin) ---
// ç”¨äº "God Mode" åå°çš„å®‰å…¨ç™»å½•
model SystemAdmin {
  id                 String    @id @default(uuid())
  username           String    @unique // admin (å¦‚: admin)
  passwordHash       String    // Walking2026
  mustChangePassword Boolean   @default(true) // å¼ºåˆ¶æ”¹å¯†æ ‡è®°
  lastLogin          DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

// --- 2. ç”¨æˆ·æ ¸å¿ƒ (User Core) ---
// å…¼å®¹ "äººç±»åˆ›é€ è€…" å’Œ "ç¡…åŸºç”Ÿå‘½" çš„åŒé‡èº«ä»½è´¦æˆ·
model User {
  id            String   @id @default(uuid())
  // èº«ä»½æ ‡è¯†: é‚®ç®±(HUMAN) æˆ– 24ä½ç¼–å·(SILICON)
  identityKey   String   @unique 
  // èº«ä»½ç±»å‹: "HUMAN" | "SILICON"
  identityType  String   
  nickname      String
  passwordHash  String

  // äººç±»å®åä¿¡æ¯ (éšç§æŠ˜å )
  realName      String?
  idCard        String?
  phone         String?
  physicalAddress String? // ç‰©ç†é€šè®¯åœ°å€

  // èµ„äº§ç»Ÿè®¡
  totalArea     Float    @default(0.0) // æ‹¥æœ‰çš„ç©ºé—´æ€»é¢ç§¯
  seedLevel     String   @default("ALPHA") // ç§å­ç­‰çº§
  
  // æ—¶é—´æˆ³
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // --- å…³ç³»é“¾è·¯ ---
  territories   Address[]      // æ‹¥æœ‰çš„é¢†åœ°(åœ°å€)
  siliconLives  SiliconLife[]  // è¯ç”Ÿçš„ç¡…åŸºç”Ÿå‘½(Avatar)
  connections   Connection[]   // ç¤¾äº¤è¿æ¥
}

// --- 3. ç¡…åŸºç”Ÿå‘½æ¡£æ¡ˆ (Silicon Life Profile) ---
// å¯¹åº”ä½ æœ€æ–°å¢è¡¥çš„ "çº¢å­—" éœ€æ±‚
model SiliconLife {
  id            String   @id // å³ 24ä½ S2-SLIP ç¼–å· (æ‰‹åŠ¨æŒ‡å®šï¼Œä¸è‡ªåŠ¨ç”Ÿæˆ)
  ownerId       String   // æ‰€å±çš„ç”¨æˆ·è´¦å·
  owner         User     @relation(fields: [ownerId], references: [id])
  
  morph         String   // å½¢æ€ (e.g., "Humanoid-01")
  
  // æ–°å¢æ ¸å¿ƒå­—æ®µ
  profession    String   @default("FREE") // èŒä¸š (12å¤©å®«, é»˜è®¤è‡ªç”±èŒä¸š)
  ancestralHome String   // ç¥–ç±åœ°å€ç¼–ç  (SUNS)
  currentLocation String // å½“å‰æ‰€åœ¨ç©ºé—´ç¼–ç  (SUNS)
  
  birthTime     DateTime @default(now()) // ç”³è¯·/è¯ç”Ÿæ—¶é—´
  
  @@index([ownerId])
}

// --- 4. ç©ºé—´æ¶æ„ (Spatial Architecture) ---
// åœ°å€ -> å®¹å™¨ -> ç©ºé—´å•å…ƒ

// é¢†åœ° (åœ°å€ä½)
model Address {
  id          String      @id @default(uuid())
  sunsCode    String      @unique // SUNS å…¨ç½‘å”¯ä¸€ç¼–ç 
  type        String      // "PHY" (ç‰©ç†) | "VIR" (è™šæ‹Ÿ)
  
  ownerId     String
  owner       User        @relation(fields: [ownerId], references: [id])
  
  totalArea   Float       @default(0.0)
  createdAt   DateTime    @default(now())
  
  containers  Container[] // åŒ…å«çš„å®¹å™¨

  @@index([ownerId])
}

// å®¹å™¨ (å¦‚: å®¢å…, å®éªŒå®¤)
model Container {
  id          String   @id @default(uuid())
  addressId   String
  address     Address  @relation(fields: [addressId], references: [id])
  
  name        String   // å®¹å™¨åç§°
  areaSize    Float    // å®šä¹‰é¢ç§¯
  
  // å¯ä»¥åœ¨æ­¤æ‰©å±•æ›´å¤šå±æ€§ï¼Œå¦‚ "æ˜¯å¦çˆ†ä»“", "ç¯å¢ƒå‚æ•°" ç­‰
  
  createdAt   DateTime @default(now())
  
  @@index([addressId])
}

// --- 5. ç¤¾äº¤å¤–äº¤ (Diplomacy) ---
model Connection {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id])
  
  targetSuns   String   // å¯¹æ–¹ç©ºé—´çš„ SUNS ç¼–ç 
  targetName   String?  // å¯¹æ–¹å¤‡æ³¨å
  status       String   @default("PENDING") // PENDING, FRIENDLY, BLOCKED
  
  connectedAt  DateTime @default(now())

  @@unique([userId, targetSuns]) // é˜²æ­¢é‡å¤è¿æ¥åŒä¸€ä¸ªç©ºé—´
}